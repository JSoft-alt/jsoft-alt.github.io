<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shen Yun USA Tour Schedule 2025-2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals (Slate, Zinc, Stone) -->
    <!-- Application Structure Plan: A single-page dashboard design was chosen for optimal user experience. It presents all information in one view, avoiding clicks and page loads. The structure includes: 1) Key Performance Indicators (KPIs) at the top for a quick overview (total shows, states, venues). 2) A central control panel with state filters and a search bar for intuitive data exploration. 3) A main content area with a sortable, filterable table for detailed information, which is the most direct way to present tabular data. 4) A complementary bar chart visualizing shows per state, offering a graphical perspective. This structure allows users to seamlessly move from a high-level overview to detailed exploration, which is more user-friendly than a simple static table. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Full performance schedule. Goal: Inform & Organize. Viz/Method: Interactive HTML Table. Interaction: Sort by column, filter by state, text search, and now click-to-view details. Justification: A table is the most effective way to display structured, multi-column data. Interactivity makes it powerful for large datasets. Method: Vanilla JS DOM manipulation.
        - Report Info: Geographic distribution of shows. Goal: Compare. Viz/Method: Horizontal Bar Chart. Interaction: Tooltips on hover. Justification: A bar chart provides an immediate visual comparison of show volumes across different states, which is easier to grasp than scanning a table. Library: Chart.js (Canvas).
        - Report Info: High-level summary. Goal: Inform. Viz/Method: KPI Cards. Interaction: None. Justification: Cards at the top provide immediate, scannable insights into the overall scale of the tour. Method: Styled HTML/Tailwind.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            height: 500px;
            max-height: 70vh;
        }
        th {
            cursor: pointer;
        }
        th .sort-indicator {
            display: inline-block;
            margin-left: 5px;
            opacity: 0.5;
            transition: opacity 0.2s;
        }
        th:hover .sort-indicator {
            opacity: 1;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 50px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .text-nowrap {
            white-space: nowrap;
        }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-2xl sm:text-3xl font-bold text-slate-900" data-i18n="headerTitle">Shen Yun USA Tour</h1>
                <p class="text-slate-500 mt-1" data-i18n="headerSubtitle">Interactive Schedule 2025-2026</p>
            </div>
            <div class="relative">
                <select id="language-switcher" class="block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                    <option value="en">English</option>
                    <option value="zh">中文</option>
                </select>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <section id="kpi-section" class="mb-8">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="bg-white p-6 rounded-lg shadow-sm text-center">
                    <h3 class="text-4xl font-bold text-blue-600" id="total-shows">--</h3>
                    <p class="text-slate-500 mt-1" data-i18n="totalPerformances">Total Performances</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm text-center">
                    <h3 class="text-4xl font-bold text-blue-600" id="total-venues">--</h3>
                    <p class="text-slate-500 mt-1" data-i18n="uniqueVenues">Unique Venues</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm text-center">
                    <h3 class="text-4xl font-bold text-blue-600" id="total-states">--</h3>
                    <p class="text-slate-500 mt-1" data-i18n="statesOnTour">States on Tour</p>
                </div>
                 <div class="bg-white p-6 rounded-lg shadow-sm text-center">
                    <h3 class="text-4xl font-bold text-blue-600" id="avg-capacity">--</h3>
                    <p class="text-slate-500 mt-1" data-i18n="avgCapacity">Avg. Venue Capacity</p>
                </div>
            </div>
        </section>

        <section id="controls-section" class="bg-white p-6 rounded-lg shadow-sm mb-8">
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                <div>
                    <label for="search-input" class="block text-sm font-medium text-slate-700" data-i18n="searchLabel">Search by City or Theater</label>
                    <input type="text" id="search-input" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" placeholder="e.g., New York or Lincoln Center">
                </div>
                <div>
                    <label for="state-filter" class="block text-sm font-medium text-slate-700" data-i18n="filterLabel">Filter by State</label>
                    <select id="state-filter" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                        <option value="all" data-i18n="allStates">All States</option>
                    </select>
                </div>
            </div>
        </section>

        <section id="table-section" class="bg-white rounded-lg shadow-sm overflow-hidden">
            <div class="p-6">
                <h2 class="text-xl font-semibold text-slate-900" data-i18n="tableTitle">Performance Details</h2>
                <p class="text-slate-500 mt-1" data-i18n="tableSubtitle">Click on a row for more details. Use the controls above to filter the schedule.</p>
            </div>
            <div id="loader" class="loader"></div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-slate-500">
                    <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-nowrap" data-sort="city" data-i18n="tableHeaderCity">City/State <span class="sort-indicator">↕</span></th>
                            <th scope="col" class="px-6 py-3" data-sort="theater" data-i18n="tableHeaderTheater">Theater Name <span class="sort-indicator">↕</span></th>
                            <th scope="col" class="px-6 py-3" data-sort="startDate" data-i18n="tableHeaderDates">Performance Dates <span class="sort-indicator">↕</span></th>
                            <th scope="col" class="px-6 py-3" data-sort="capacity" data-i18n="tableHeaderCapacity">Seating Capacity <span class="sort-indicator">↕</span></th>
                        </tr>
                    </thead>
                    <tbody id="schedule-table-body">
                    </tbody>
                </table>
            </div>
        </section>

        <section id="chart-section" class="bg-white rounded-lg shadow-sm mt-8 p-6">
            <h2 class="text-xl font-semibold text-slate-900 mb-2" data-i18n="chartTitle">Performances by State</h2>
            <p class="text-slate-500 mb-4" data-i18n="chartSubtitle">This chart shows the total number of individual showtimes scheduled in each state, providing a visual overview of the tour's distribution across the country.</p>
            <div class="chart-container">
                <canvas id="shows-by-state-chart"></canvas>
            </div>
        </section>

    </main>
    
    <div id="details-modal" class="fixed inset-0 bg-slate-900 bg-opacity-75 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 sm:p-8 max-w-lg w-full transform transition-all scale-100 opacity-100" id="modal-content-container">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl sm:text-2xl font-semibold text-slate-900" id="modal-title"></h3>
                <button id="modal-close" class="text-slate-400 hover:text-slate-600 transition-colors duration-200" aria-label="Close modal">
                    <span class="text-2xl">×</span>
                </button>
            </div>
            <div id="modal-body" class="text-slate-700">
                <p class="mb-2"><strong class="text-slate-800" data-i18n="modalAddress">Address:</strong> <a id="modal-address-link" href="#" target="_blank" class="text-blue-600 hover:underline"></a></p>
                <p class="mb-2"><strong class="text-slate-800" data-i18n="modalDates">Dates:</strong> <span id="modal-dates"></span></p>
                <p class="mb-2"><strong class="text-slate-800" data-i18n="modalCapacity">Seating Capacity:</strong> <span id="modal-capacity"></span></p>
                <div class="mt-4">
                    <h4 class="font-bold text-slate-800" data-i18n="modalTimesHeader">Performance Times:</h4>
                    <!-- Display performance times with a new line for each date and a comma for same-day times -->
                    <p id="modal-times" class="mt-2 text-slate-600 whitespace-pre-line"></p>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-white mt-12 py-6 border-t border-slate-200">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center text-slate-500 text-sm">
            <p data-i18n="footerText">&copy; 2025 Interactive Schedule. Data compiled from publicly available sources for informational purposes.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const performanceData = [
                { theater: "San Jose Center for the Performing Arts", city: "San Jose", state: "CA", address: "255 S Almaden Blvd, San Jose, CA 95113", dates: "Dec 24–28, 2025", times: "Dec 24: 2:00 PM, Dec 26: 7:00 PM, Dec 27: 2:00 PM, 7:00 PM, Dec 28: 2:00 PM", capacity: 2677 },
                { theater: "Jones Hall for the Performing Arts", city: "Houston", state: "TX", address: "615 Louisiana St, Houston, TX 77002", dates: "Dec 26–30, 2025", times: "Dec 26: 1:00 PM, Dec 27: 2:00 PM, 7:30 PM, Dec 28: 2:00 PM, 7:30 PM, Dec 29: 7:30 PM, Dec 30: 7:30 PM", capacity: 2912 },
                { theater: "Palace Theater", city: "Waterbury", state: "CT", address: "100 E Main St, Waterbury, CT 06702", dates: "Dec 27, 2025", times: "Dec 27: 2:00 PM, 7:00 PM", capacity: 2900 },
                { theater: "War Memorial Opera House", city: "San Francisco", state: "CA", address: "301 Van Ness Ave, San Francisco, CA 94102", dates: "Dec 31, 2025–Jan 4, 2026", times: "Dec 31: 2:00 PM, Jan 2: 7:00 PM, Jan 3: 2:00 PM, Jan 4: 2:00 PM", capacity: 3126 },
                { theater: "Kravis Center for the Performing Arts", city: "West Palm Beach", state: "FL", address: "701 Okeechobee Blvd, West Palm Beach, FL 33401", dates: "Feb 2–3, 2026", times: "Feb 2: 7:30 PM, Feb 3: 7:30 PM", capacity: 2195 },
                { theater: "W.L. Jack Howard Theatre", city: "Monroe", state: "LA", address: "401 Lea Joyner Expy, Monroe, LA 71201", dates: "Feb 3, 2026", times: "Feb 3: 7:30 PM", capacity: 2200 },
                { theater: "Youkey Theatre, RP Funding Center", city: "Lakeland", state: "FL", address: "701 W Lime St, Lakeland, FL 33815", dates: "Feb 3–4, 2026", times: "Feb 3: 7:30 PM, Feb 4: 2:00 PM", capacity: 2286 },
                { theater: "Duke Energy Center for the Arts – Mahaffey Theater", city: "St. Petersburg", state: "FL", address: "400 1st St S, St. Petersburg, FL 33701", dates: "Feb 6–8, 2026", times: "Feb 6: 7:30 PM, Feb 7: 2:00 PM, Feb 8: 2:00 PM", capacity: 2031 },
                { theater: "Cannon Center for the Performing Arts", city: "Memphis", state: "TN", address: "255 N Main St, Memphis, TN 38103", dates: "Feb 10, 2026", times: "Feb 10: 7:30 PM", capacity: 2050 },
                { theater: "Thrasher-Horne Center", city: "Orange Park", state: "FL", address: "283 College Dr, Orange Park, FL 32065", dates: "Feb 10–11, 2026", times: "Feb 10: 7:30 PM, Feb 11: 7:30 PM", capacity: 1725 },
                { theater: "Knoxville Civic Auditorium and Coliseum", city: "Knoxville", state: "TN", address: "500 Howard Baker Jr Ave, Knoxville, TN 37915", dates: "Feb 14–15, 2026", times: "Feb 14: 2:00 PM, Feb 15: 2:00 PM", capacity: 2500 },
                { theater: "Broward Center for the Performing Arts – Au-Rene Theatre", city: "Fort Lauderdale", state: "FL", address: "201 SW 5th Ave, Fort Lauderdale, FL 33312", dates: "Feb 17–18, 2026", times: "Feb 17: 7:30 PM, Feb 18: 2:00 PM, 7:30 PM", capacity: 2688 },
                { theater: "Belk Theater at Blumenthal Performing Arts Center", city: "Charlotte", state: "NC", address: "130 N Tryon St, Charlotte, NC 28202", dates: "Feb 20–22, 2026", times: "Feb 20: 7:30 PM, Feb 21: 2:00 PM, 7:30 PM, Feb 22: 2:00 PM", capacity: 2100 },
                { theater: "McAllen Performing Arts Center", city: "McAllen", state: "TX", address: "801 Convention Center Blvd, McAllen, TX 78501", dates: "Feb 21–22, 2026", times: "Feb 21: 7:00 PM, Feb 22: 2:00 PM", capacity: 1800 },
                { theater: "Steven Tanger Center for the Performing Arts", city: "Greensboro", state: "NC", address: "300 N Elm St, Greensboro, NC 27401", dates: "Mar 4, 2026", times: "Mar 4: 7:30 PM", capacity: 3000 },
                { theater: "Memorial Auditorium at Martin Marietta Center", city: "Raleigh", state: "NC", address: "2 E South St, Raleigh, NC 27601", dates: "Mar 7–8, 2026", times: "Mar 7: 7:30 PM, Mar 8: 2:00 PM", capacity: 2277 },
                { theater: "Koger Center for the Arts", city: "Columbia", state: "SC", address: "1051 Greene St, Columbia, SC 29201", dates: "Mar 10–11, 2026", times: "Mar 10: 7:30 PM, Mar 11: 7:30 PM", capacity: 2248 },
                { theater: "Wagner Noël Performing Arts Center", city: "Midland", state: "TX", address: "1559 N FM 1788, Midland, TX 79707", dates: "Mar 11, 2026", times: "Mar 11: 7:30 PM", capacity: 1811 },
                { theater: "George S. and Dolores Doré Eccles Theater", city: "Salt Lake City", state: "UT", address: "131 S Main St, Salt Lake City, UT 84111", dates: "Mar 13–18, 2026", times: "Mar 13: 7:00 PM, Mar 14: 2:00 PM, Mar 15: 2:00 PM, Mar 17: 7:00 PM, Mar 18: 2:00 PM", capacity: 2468 },
                { theater: "Adrienne Arsht Center for the Performing Arts", city: "Miami", state: "FL", address: "1300 Biscayne Blvd, Miami, FL 33132", dates: "Mar 13–15, 2026", times: "Mar 13: 7:30 PM, Mar 14: 2:00 PM, Mar 15: 2:00 PM", capacity: 2400 },
                { theater: "The Plaza Theatre", city: "El Paso", state: "TX", address: "125 Pioneer Plaza, El Paso, TX 79901", dates: "Mar 14, 2026", times: "Mar 14: 7:30 PM", capacity: 2050 },
                { theater: "RiverCenter for the Performing Arts", city: "Columbus", state: "GA", address: "900 Broadway, Columbus, GA 31901", dates: "Mar 17, 2026", times: "Mar 17: 7:30 PM", capacity: 2000 },
                { theater: "Montgomery Performing Arts Centre", city: "Montgomery", state: "AL", address: "201 Tallapoosa St, Montgomery, AL 36104", dates: "Mar 18, 2026", times: "Mar 18: 7:30 PM", capacity: 1750 },
                { theater: "SAFE Credit Union Performing Arts Center", city: "Sacramento", state: "CA", address: "1301 L St, Sacramento, CA 95814", dates: "Mar 26–29, 2026", times: "Mar 26: 7:00 PM, Mar 27: 2:00 PM, Mar 28: 2:00 PM, 7:00 PM, Mar 29: 1:00 PM", capacity: 2392 },
                { theater: "The David H. Koch Theater at Lincoln Center", city: "New York", state: "NY", address: "20 Lincoln Center Plaza, New York, NY 10023", dates: "Mar 25–Apr 12, 2026", times: "Mar 25: 7:00 PM, Mar 26: 2:00 PM, Mar 27: 7:00 PM, Mar 28: 1:00 PM, 6:00 PM, Mar 29: 1:00 PM, Apr 1: 2:00 PM, Apr 2: 2:00 PM, Apr 3: 7:00 PM, Apr 4: 1:00 PM, 6:00 PM, Apr 5: 1:00 PM, Apr 8: 2:00 PM, Apr 9: 2:00 PM, Apr 10: 7:00 PM, Apr 11: 1:00 PM, 6:00 PM, Apr 12: 1:00 PM", capacity: 2586 },
                { theater: "Marion Oliver McCaw Hall", city: "Seattle", state: "WA", address: "321 Mercer St, Seattle, WA 98109", dates: "Apr 1–5, 2026", times: "Apr 1: 7:00 PM, Apr 2: 2:00 PM, Apr 3: 7:00 PM, Apr 4: 2:00 PM, 7:00 PM, Apr 5: 2:00 PM", capacity: 2896 },
                { theater: "Pikes Peak Center for the Performing Arts", city: "Colorado Springs", state: "CO", address: "190 S Cascade Ave, Colorado Springs, CO 80903", dates: "Apr 3–5, 2026", times: "Apr 3: 7:00 PM, Apr 4: 2:00 PM, Apr 5: 2:00 PM", capacity: 2030 },
                { theater: "The Buell Theatre", city: "Denver", state: "CO", address: "1350 Curtis St, Denver, CO 80204", dates: "Apr 8–12, 2026", times: "Apr 8: 2:00 PM, Apr 9: 7:00 PM, Apr 10: 7:00 PM, Apr 11: 2:00 PM, Apr 12: 2:00 PM", capacity: 2839 },
                { theater: "Boch Center Wang Theatre", city: "Boston", state: "MA", address: "270 Tremont St, Boston, MA 02116", dates: "Apr 10–12, 2026", times: "Apr 10: 1:30 PM, Apr 11: 1:30 PM, 7:00 PM, Apr 12: 1:30 PM", capacity: 3500 },
                { theater: "The Hippodrome Theatre", city: "Baltimore", state: "MD", address: "12 N Eutaw St, Baltimore, MD 21201", dates: "Apr 18–19, 2026", times: "Apr 18: 2:00 PM, 7:30 PM, Apr 19: 2:00 PM", capacity: 2284 },
                { theater: "Chrysler Hall", city: "Norfolk", state: "VA", address: "215 St Pauls Blvd, Norfolk, VA 23510", dates: "Apr 22–23, 2026", times: "Apr 22: 7:30 PM, Apr 23: 1:00 PM", capacity: 2500 },
                { theater: "The Hanover Theatre", city: "Worcester", state: "MA", address: "2 Southbridge St, Worcester, MA 01608", dates: "Apr 25–26, 2026", times: "Apr 25: 1:30 PM, 7:00 PM, Apr 26: 1:30 PM", capacity: 2300 },
                { theater: "New Jersey Performing Arts Center", city: "Newark", state: "NJ", address: "1 Center St, Newark, NJ 07102", dates: "Apr 29–May 3, 2026", times: "Apr 29: 2:00 PM, Apr 30: 2:00 PM, May 1: 7:00 PM, May 2: 1:00 PM, 6:00 PM, May 3: 1:00 PM", capacity: 2868 }
            ];

            const translations = {
                en: {
                    headerTitle: "Shen Yun USA Tour",
                    headerSubtitle: "Interactive Schedule 2025-2026",
                    totalPerformances: "Total Performances",
                    uniqueVenues: "Unique Venues",
                    statesOnTour: "States on Tour",
                    avgCapacity: "Avg. Venue Capacity",
                    searchLabel: "Search by City or Theater",
                    filterLabel: "Filter by State",
                    allStates: "All States",
                    tableTitle: "Performance Details",
                    tableSubtitle: "Click on a row for more details. Use the controls above to filter the schedule.",
                    tableHeaderCity: "City/State",
                    tableHeaderTheater: "Theater Name",
                    tableHeaderDates: "Performance Dates",
                    tableHeaderCapacity: "Seating Capacity",
                    chartTitle: "Performances by State",
                    chartSubtitle: "This chart shows the total number of individual showtimes scheduled in each state, providing a visual overview of the tour's distribution across the country.",
                    modalAddress: "Address:",
                    modalDates: "Dates:",
                    modalCapacity: "Seating Capacity:",
                    modalTimesHeader: "Performance Times:",
                    modalNotFound: "No performances found matching your criteria.",
                    footerText: "&copy; 2025 Interactive Schedule. Data compiled from publicly available sources for informational purposes."
                },
                zh: {
                    headerTitle: "神韵美国巡演",
                    headerSubtitle: "互动时间表 2025-2026",
                    totalPerformances: "总场次",
                    uniqueVenues: "独特场馆",
                    statesOnTour: "巡演州数",
                    avgCapacity: "平均场馆容量",
                    searchLabel: "按城市或剧院搜索",
                    filterLabel: "按州筛选",
                    allStates: "所有州",
                    tableTitle: "演出详情",
                    tableSubtitle: "点击行以获取更多详细信息。使用上方控件筛选时间表。",
                    tableHeaderCity: "城市/州",
                    tableHeaderTheater: "剧院名称",
                    tableHeaderDates: "演出日期",
                    tableHeaderCapacity: "座位容量",
                    chartTitle: "各州演出场次",
                    chartSubtitle: "此图表显示了每个州安排的演出总场次，提供了巡演在美国各地的视觉概览。",
                    modalAddress: "地址：",
                    modalDates: "日期：",
                    modalCapacity: "座位容量：",
                    modalTimesHeader: "演出时间：",
                    modalNotFound: "未找到符合您条件的演出。",
                    footerText: "&copy; 2025 神韵互动时间表。数据来自公开来源，仅供参考。"
                }
            };

            const languageSwitcher = document.getElementById('language-switcher');
            const tableBody = document.getElementById('schedule-table-body');
            const searchInput = document.getElementById('search-input');
            const stateFilter = document.getElementById('state-filter');
            const loader = document.getElementById('loader');

            const modal = document.getElementById('details-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalAddressLink = document.getElementById('modal-address-link');
            const modalDates = document.getElementById('modal-dates');
            const modalCapacity = document.getElementById('modal-capacity');
            const modalTimes = document.getElementById('modal-times');
            const modalCloseBtn = document.getElementById('modal-close');
            
            let currentSort = { column: 'startDate', order: 'asc' };
            let chartInstance = null;
            
            function parseDate(dateStr) {
                const monthDay = dateStr.split(' ')[0] + " " + dateStr.split(' ')[1].match(/\d+/)[0];
                let year = dateStr.includes('2025') ? 2025 : 2026;
                if (dateStr.toLowerCase().includes('dec')) {
                    year = 2025;
                }
                return new Date(`${monthDay}, ${year}`);
            }

            const processedData = performanceData.map(d => ({
                ...d,
                startDate: parseDate(d.dates),
                showCount: (d.times.match(/PM|AM/g) || []).length
            }));
            
            function sortData(data, column, order) {
                return [...data].sort((a, b) => {
                    let valA = a[column];
                    let valB = b[column];
                    let comparison = 0;
                    if (valA > valB) {
                        comparison = 1;
                    } else if (valA < valB) {
                        comparison = -1;
                    }
                    return order === 'asc' ? comparison : -comparison;
                });
            }

            function showModal(item) {
                modalTitle.textContent = `${item.theater}`;
                
                modalAddressLink.textContent = item.address;
                const encodedAddress = encodeURIComponent(item.address);
                modalAddressLink.href = `https://www.google.com/maps/search/?api=1&query=${encodedAddress}`;
                
                modalDates.textContent = item.dates;
                modalCapacity.textContent = item.capacity.toLocaleString();
                
                const formattedTimes = item.times.replace(/, (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)/g, '\n$1').trim();
                modalTimes.textContent = formattedTimes;
                
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }

            function closeModal() {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }

            function renderTable(data) {
                tableBody.innerHTML = '';
                if (data.length === 0) {
                    const noResultsMessage = languageSwitcher.value === 'zh' ? translations.zh.modalNotFound : translations.en.modalNotFound;
                    tableBody.innerHTML = `<tr><td colspan="4" class="text-center py-10 px-6">${noResultsMessage}</td></tr>`;
                    return;
                }
                data.forEach(item => {
                    const row = document.createElement('tr');
                    row.className = 'bg-white border-b hover:bg-slate-50 cursor-pointer';
                    row.innerHTML = `
                        <td class="px-6 py-4 font-medium text-slate-900">${item.city}, ${item.state}</td>
                        <td class="px-6 py-4">${item.theater}</td>
                        <td class="px-6 py-4">${item.dates}</td>
                        <td class="px-6 py-4">${item.capacity.toLocaleString()}</td>
                    `;
                    row.addEventListener('click', () => showModal(item));
                    tableBody.appendChild(row);
                });
            }
            
            function updateLanguage(lang) {
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (translations[lang] && translations[lang][key]) {
                        if (el.tagName === 'TH' || el.tagName === 'SELECT' && el.value === 'all') {
                            el.childNodes[0].nodeValue = translations[lang][key] + ' ';
                        } else {
                           el.textContent = translations[lang][key];
                        }
                    }
                });
                
                // Special handling for the search input placeholder
                const searchInput = document.getElementById('search-input');
                searchInput.placeholder = lang === 'zh' ? '例如：纽约 或 林肯中心' : 'e.g., New York or Lincoln Center';
                
                // Special handling for `All States` option
                const allStatesOption = document.querySelector('#state-filter option[value="all"]');
                allStatesOption.textContent = translations[lang].allStates;

                // Re-render table and chart with the new language
                filterAndRender();
                renderChart();
            }

            function updateKPIs(data) {
                const totalShows = data.reduce((sum, item) => sum + item.showCount, 0);
                document.getElementById('total-shows').textContent = totalShows;
                document.getElementById('total-venues').textContent = new Set(data.map(d => d.theater)).size;
                document.getElementById('total-states').textContent = new Set(data.map(d => d.state)).size;
                const avgCapacity = data.reduce((sum, item) => sum + item.capacity, 0) / data.length;
                document.getElementById('avg-capacity').textContent = Math.round(avgCapacity).toLocaleString();
            }

            function populateStateFilter() {
                const states = [...new Set(processedData.map(item => item.state))].sort();
                states.forEach(state => {
                    const option = document.createElement('option');
                    option.value = state;
                    option.textContent = state;
                    stateFilter.appendChild(option);
                });
            }

            function filterAndRender() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedState = stateFilter.value;

                let filteredData = processedData;

                if (selectedState !== 'all') {
                    filteredData = filteredData.filter(item => item.state === selectedState);
                }

                if (searchTerm) {
                    filteredData = filteredData.filter(item => 
                        item.city.toLowerCase().includes(searchTerm) || 
                        item.theater.toLowerCase().includes(searchTerm)
                    );
                }
                
                const sortedData = sortData(filteredData, currentSort.column, currentSort.order);
                renderTable(sortedData);
            }

            function renderChart() {
                const showsByState = processedData.reduce((acc, curr) => {
                    acc[curr.state] = (acc[curr.state] || 0) + curr.showCount;
                    return acc;
                }, {});

                const sortedStates = Object.entries(showsByState).sort(([, a], [, b]) => b - a);

                const chartLabels = sortedStates.map(item => item[0]);
                const chartData = sortedStates.map(item => item[1]);

                const ctx = document.getElementById('shows-by-state-chart').getContext('2d');
                if (chartInstance) {
                    chartInstance.destroy();
                }
                chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: chartLabels,
                        datasets: [{
                            label: languageSwitcher.value === 'zh' ? '演出场次' : '# of Performances',
                            data: chartData,
                            backgroundColor: 'rgba(59, 130, 246, 0.5)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: languageSwitcher.value === 'zh' ? '演出总场数' : 'Number of Performances'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const unit = languageSwitcher.value === 'zh' ? '场' : 'performances';
                                        return ` ${context.raw} ${unit}`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            document.querySelectorAll('th[data-sort]').forEach(th => {
                th.addEventListener('click', () => {
                    const column = th.dataset.sort;
                    const order = (currentSort.column === column && currentSort.order === 'asc') ? 'desc' : 'asc';
                    currentSort = { column, order };
                    filterAndRender();
                });
            });

            searchInput.addEventListener('input', filterAndRender);
            stateFilter.addEventListener('change', filterAndRender);
            languageSwitcher.addEventListener('change', (e) => updateLanguage(e.target.value));
            modalCloseBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target.id === 'details-modal') {
                    closeModal();
                }
            });

            setTimeout(() => {
                loader.style.display = 'none';
                document.querySelector('#table-section .overflow-x-auto').style.display = 'block';
                
                updateKPIs(processedData);
                populateStateFilter();
                updateLanguage('en'); // Set initial language to English
            }, 1000);
        });
    </script>
</body>
</html>
