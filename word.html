<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Sentence Generator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container-card {
            transition: all 0.3s ease-in-out;
        }
        /* Custom spinner animation */
        .spinner {
            border: 4px solid #f3f3f3; 
            border-top: 4px solid #4f46e5; 
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4">

    <div class="max-w-xl w-full bg-white p-8 sm:p-10 rounded-xl shadow-2xl border border-gray-100 container-card">
        <!-- Main Heading -->
        <h1 class="text-3xl sm:text-4xl font-extrabold text-indigo-700 mb-6 border-b-4 border-indigo-200 pb-2">
            Easy Sentence Generator
        </h1>

        <p class="text-gray-600 mb-6">
            Type a word below and press "Generate" to instantly create three short, clear sentences using the word.
        </p>

        <!-- Input Area -->
        <div class="flex flex-col sm:flex-row gap-3 mb-8">
            <input 
                id="word-input" 
                type="text" 
                placeholder="Type your word here (e.g., 'elucidate')" 
                class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-lg shadow-sm"
                onkeydown="if(event.key === 'Enter') generateSentences()"
            />
            <button 
                id="generate-button" 
                onclick="generateSentences()" 
                class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-[1.02] active:scale-95 disabled:bg-indigo-300 disabled:cursor-not-allowed flex-shrink-0"
            >
                Generate
            </button>
        </div>

        <!-- Loading & Results Area -->
        <div id="loading-indicator" class="hidden flex items-center justify-center p-4 bg-yellow-50 rounded-lg">
            <div class="spinner mr-3"></div>
            <p class="text-yellow-800 font-medium">Generating sentences...</p>
        </div>

        <div id="results-container" class="mt-8">
            <!-- Dynamic content will be inserted here -->
            <div class="space-y-6" id="initial-message">
                <h3 class="text-2xl font-semibold text-gray-700">Get Started</h3>
                <p class="text-gray-500">Your generated sentences will appear here.</p>
            </div>
        </div>
        
        <!-- History Toggle Button -->
        <button 
            id="history-toggle-button" 
            onclick="toggleHistory()" 
            class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg shadow-inner transition duration-300 ease-in-out mt-8"
        >
            Show History
        </button>

        <!-- History Container -->
        <div id="history-content" class="hidden mt-4 border border-gray-300 rounded-xl bg-gray-50 shadow-lg">
            <div class="flex justify-between items-center p-4 border-b border-gray-300">
                <h3 class="text-2xl font-bold text-gray-700">Search History</h3>
                <button 
                    id="clear-history-button" 
                    onclick="clearHistory()" 
                    class="text-sm text-red-600 hover:text-red-800 font-medium px-3 py-1 bg-white rounded-md border border-gray-200 hover:bg-red-50 transition hidden"
                >
                    Clear History
                </button>
            </div>
            <div id="history-list" class="p-4 max-h-96 overflow-y-auto divide-y divide-gray-200">
                <!-- History items rendered here -->
            </div>
        </div>

        <footer class="mt-10 text-center text-gray-400 text-sm">
            <p>Powered by the Gemini API</p>
        </footer>
    </div>

    <script>
        const inputField = document.getElementById('word-input');
        const generateButton = document.getElementById('generate-button');
        const loadingIndicator = document.getElementById('loading-indicator');
        const resultsContainer = document.getElementById('results-container');
        
        // History Elements
        const historyList = document.getElementById('history-list');
        const clearButton = document.getElementById('clear-history-button');
        const historyContent = document.getElementById('history-content');
        const historyToggleButton = document.getElementById('history-toggle-button');

        // --- History State ---
        const HISTORY_KEY = 'sentenceGeneratorHistory';
        let sentenceHistory = [];
        
        // --- API Configuration ---
        const MODEL_NAME = 'gemini-2.5-flash-preview-05-20';
        const apiKey = ""; // Leave as empty string for Canvas environment
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`;

        // System instructions and JSON schema for structured output
        const systemPrompt = "You are a concise language expert. Given a single word, your task is to generate exactly three short, easy-to-understand sentences using that word. The sentences must be appropriate for a grade school level. Return the output as a JSON object.";
        
        const responseSchema = {
            type: "OBJECT",
            properties: {
                "word": { "type": "STRING", "description": "The word provided by the user." },
                "sentences": {
                    "type": "ARRAY",
                    "items": { "type": "STRING" },
                    "description": "An array containing exactly three short, easy-to-understand sentences."
                }
            },
            propertyOrdering: ["word", "sentences"]
        };

        /**
         * Loads history from localStorage on startup.
         */
        function loadHistory() {
            try {
                const historyString = localStorage.getItem(HISTORY_KEY);
                if (historyString) {
                    sentenceHistory = JSON.parse(historyString);
                    // Basic validation
                    if (!Array.isArray(sentenceHistory)) {
                        sentenceHistory = [];
                    }
                }
            } catch (e) {
                console.error("Could not load history from localStorage", e);
                sentenceHistory = [];
            }
            renderHistory();
        }

        /**
         * Saves current history state to localStorage and re-renders the history view.
         */
        function saveHistory() {
            try {
                localStorage.setItem(HISTORY_KEY, JSON.stringify(sentenceHistory));
            } catch (e) {
                console.error("Could not save history to localStorage", e);
            }
            renderHistory();
        }

        /**
         * Renders the history list HTML.
         */
        function renderHistory() {
            if (sentenceHistory.length === 0) {
                historyList.innerHTML = '<p class="text-gray-500 italic p-4 text-center">No previous searches found.</p>';
                clearButton.classList.add('hidden');
                return;
            }

            clearButton.classList.remove('hidden');

            let listHtml = '';
            // Iterate and create HTML for each historical entry
            sentenceHistory.forEach((item) => {
                const sentencesHtml = item.sentences.map((s, i) => {
                    // Highlight the target word in the sentence
                    const highlightedSentence = s.replace(
                        new RegExp(`\\b${item.word}\\b`, 'gi'), 
                        `<strong class="text-indigo-600 font-bold">${item.word}</strong>`
                    );
                    return `<li class="text-sm text-gray-700">${i + 1}. ${highlightedSentence}</li>`;
                }).join('');
                
                listHtml += `
                    <div class="border-b border-gray-200 py-4 last:border-b-0">
                        <h4 class="text-xl font-semibold text-gray-800 mb-2">${item.word}</h4>
                        <ul class="list-none space-y-1 pl-0">
                            ${sentencesHtml}
                        </ul>
                    </div>
                `;
            });
            
            historyList.innerHTML = listHtml;
        }

        /**
         * Toggles the visibility of the history panel.
         */
        function toggleHistory() {
            const isHidden = historyContent.classList.toggle('hidden');
            historyToggleButton.textContent = isHidden ? "Show History" : "Hide History";
        }
        
        /**
         * Clears all history from state and localStorage.
         */
        function clearHistory() {
            sentenceHistory = [];
            saveHistory();
            // Close the history panel after clearing
            historyContent.classList.add('hidden');
            historyToggleButton.textContent = "Show History";
        }


        /**
         * Converts the structured JSON response into HTML for display.
         * @param {Object} data - The parsed JSON object from the API.
         * @returns {string} The HTML string to be injected.
         */
        function renderResults(data) {
            const sentencesHtml = data.sentences.map((sentence, index) => {
                // Highlight the target word in the sentence
                const highlightedSentence = sentence.replace(
                    new RegExp(`\\b${data.word}\\b`, 'gi'), 
                    `<strong class="text-indigo-600 font-bold">${data.word}</strong>`
                );

                return `
                    <div class="p-4 bg-indigo-50 rounded-lg shadow-inner">
                        <p class="text-gray-800 text-lg">
                            ${index + 1}. ${highlightedSentence}
                        </p>
                    </div>
                `;
            }).join('');

            return `
                <div class="mt-6 mb-8">
                    <h2 class="text-4xl sm:text-5xl font-black text-gray-800 tracking-tight">
                        ${data.word}
                    </h2>
                </div>
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">Example Sentences (Short & Simple)</h3>
                <div class="space-y-4">
                    ${sentencesHtml}
                </div>
            `;
        }

        /**
         * Main function to handle the API call and UI updates.
         */
        async function generateSentences() {
            const word = inputField.value.trim();
            if (!word) {
                console.error("Please enter a word."); 
                resultsContainer.innerHTML = `<p class="text-red-500 p-4">Please enter a word before generating sentences.</p>`;
                return;
            }

            // UI State: Loading
            generateButton.disabled = true;
            loadingIndicator.classList.remove('hidden');
            resultsContainer.innerHTML = '';
            
            const userQuery = `Generate three short, easy-to-understand sentences using the word: ${word}`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: responseSchema
                }
            };

            let response;
            
            // Perform a single, fast API call
            try {
                response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
            } catch (error) {
                console.error("Fetch failed:", error);
                // Handle network errors
                loadingIndicator.classList.add('hidden');
                generateButton.disabled = false;
                resultsContainer.innerHTML = `<p class="text-red-500 p-4 bg-red-100 rounded-lg">Network error. Please check your connection and try again.</p>`;
                return;
            }
            
            // UI State: Finished Loading
            loadingIndicator.classList.add('hidden');
            generateButton.disabled = false;

            if (!response.ok) {
                const errorText = response.statusText || 'Unknown error';
                resultsContainer.innerHTML = `<p class="text-red-500 p-4 bg-red-100 rounded-lg">API Error (${response.status}): ${errorText}. Please try again.</p>`;
                return;
            }

            try {
                const result = await response.json();
                
                const candidate = result.candidates?.[0];
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const jsonString = candidate.content.parts[0].text;
                    const data = JSON.parse(jsonString);

                    // Validate the expected structure
                    if (data.word && Array.isArray(data.sentences) && data.sentences.length === 3) {
                        resultsContainer.innerHTML = renderResults(data);
                        
                        // NEW: Add result to history
                        sentenceHistory.unshift(data); // Add the newest entry to the start
                        saveHistory(); // Save to local storage and re-render history UI
                    } else {
                        throw new Error("Invalid response structure from model.");
                    }
                } else {
                    throw new Error("Model response was empty or malformed.");
                }

            } catch (error) {
                console.error("Processing API response failed:", error);
                resultsContainer.innerHTML = `<p class="text-red-500 p-4 bg-red-100 rounded-lg">An error occurred while parsing the response. (Details: ${error.message})</p>`;
            }
        }
        
        // Load history when the script first runs
        loadHistory();
    </script>

</body>
</html>
